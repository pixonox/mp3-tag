<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID3v2 Music Metadata Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(30, 30, 50, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #1e1e3f, #2d2d5f);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .file-upload {
            border: 3px dashed #4a9eff;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: linear-gradient(135deg, #252545, #2a2a4a);
            color: #e0e0e0;
        }

        .file-upload:hover {
            border-color: #64b5f6;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 158, 255, 0.2);
            background: linear-gradient(135deg, #2a2a4a, #2f2f4f);
        }

        .file-upload.drag-over {
            background: linear-gradient(135deg, #1e3a5f, #2a4a6f);
            border-color: #64b5f6;
            box-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .upload-text {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #888;
            font-size: 0.9em;
        }

        .editor-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .file-info {
            background: linear-gradient(135deg, #1a3a1a, #2a4a2a);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4caf50;
            color: #e0e0e0;
        }

        .file-info h3 {
            color: #66bb6a;
            margin-bottom: 10px;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .field-group {
            background: linear-gradient(135deg, #2a2a4a, #323252);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .field-group:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 158, 255, 0.2);
        }

        .field-group label {
            display: block;
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 8px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .field-group input,
        .field-group textarea,
        .field-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #3a3a5a;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #1a1a2e;
            color: #e0e0e0;
        }

        .field-group input:focus,
        .field-group textarea:focus,
        .field-group select:focus {
            outline: none;
            border-color: #4a9eff;
            background: #252545;
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
        }

        .field-group input::placeholder,
        .field-group textarea::placeholder {
            color: #8a8aa0;
        }

        .field-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .artwork-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #3a2a1a, #4a3a2a);
            border-left: 5px solid #ff9800;
        }

        .artwork-preview {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .artwork-preview img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .artwork-info {
            flex: 1;
        }

        .artwork-upload {
            background: #2a2a4a;
            border: 2px dashed #ff9800;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #e0e0e0;
        }

        .artwork-upload:hover {
            background: #323252;
            border-color: #ffb74d;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a9eff, #6fa8ff);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 158, 255, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(244, 67, 54, 0.3);
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .status-success {
            background: linear-gradient(135deg, #1a3a1a, #2a4a2a);
            color: #66bb6a;
            border: 1px solid #4caf50;
        }

        .status-error {
            background: linear-gradient(135deg, #3a1a1a, #4a2a2a);
            color: #ef5350;
            border: 1px solid #f44336;
        }

        .status-warning {
            background: linear-gradient(135deg, #3a2a1a, #4a3a2a);
            color: #ffb74d;
            border: 1px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ ID3v2 Metadata Editor</h1>
            <p>Edit and manage your music file metadata with ease</p>
        </div>

        <div class="main-content">
            <div class="file-upload" id="fileUpload">
                <div class="upload-icon">üéµ</div>
                <div class="upload-text">Drop your music file here or click to browse</div>
                <div class="upload-hint">Supports MP3, FLAC, M4A, AAC, OGG, WAV, WMA</div>
                <input type="file" id="fileInput" class="file-input" accept=".mp3,.flac,.m4a,.aac,.ogg,.wav,.wma">
            </div>

            <div class="editor-section" id="editorSection">
                <div class="file-info" id="fileInfo"></div>

                <div class="metadata-grid">
                    <div class="field-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" placeholder="Song Title">
                    </div>

                    <div class="field-group">
                        <label for="artist">Artist</label>
                        <input type="text" id="artist" placeholder="Artist Name">
                    </div>

                    <div class="field-group">
                        <label for="album">Album</label>
                        <input type="text" id="album" placeholder="Album Title">
                    </div>

                    <div class="field-group">
                        <label for="albumArtist">Album Artist</label>
                        <input type="text" id="albumArtist" placeholder="Album Artist">
                    </div>

                    <div class="field-group">
                        <label for="year">Year</label>
                        <input type="number" id="year" placeholder="2024" min="1900" max="2030">
                    </div>

                    <div class="field-group">
                        <label for="track">Track Number</label>
                        <input type="text" id="track" placeholder="1/12">
                    </div>

                    <div class="field-group">
                        <label for="genre">Genre</label>
                        <select id="genre">
                            <option value="">Select Genre</option>
                            <option value="Rock">Rock</option>
                            <option value="Pop">Pop</option>
                            <option value="Jazz">Jazz</option>
                            <option value="Classical">Classical</option>
                            <option value="Hip-Hop">Hip-Hop</option>
                            <option value="Electronic">Electronic</option>
                            <option value="Country">Country</option>
                            <option value="Folk">Folk</option>
                            <option value="R&B">R&B</option>
                            <option value="Alternative">Alternative</option>
                        </select>
                    </div>

                    <div class="field-group">
                        <label for="composer">Composer</label>
                        <input type="text" id="composer" placeholder="Composer Name">
                    </div>

                    <div class="field-group artwork-section">
                        <label>Album Artwork</label>
                        <div class="artwork-upload" id="artworkUpload">
                            <div>üñºÔ∏è Click to upload artwork</div>
                            <input type="file" id="artworkInput" accept="image/*" style="display: none;">
                        </div>
                        <div class="artwork-preview" id="artworkPreview"></div>
                    </div>

                    <div class="field-group" style="grid-column: 1 / -1;">
                        <label for="comment">Comments</label>
                        <textarea id="comment" placeholder="Additional comments or notes"></textarea>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" id="loadMetadata">üîÑ Reload Metadata</button>
                    <button class="btn btn-primary" id="saveMetadata">üíæ Save Changes</button>
                    <button class="btn btn-danger" id="clearAll">üóëÔ∏è Clear All</button>
                </div>

                <div id="statusMessage"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.7/jsmediatags.min.js"></script>
    <script>
        let currentFile = null;
        let originalMetadata = {};

        // File upload handling
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');
        const editorSection = document.getElementById('editorSection');

        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', handleDragOver);
        fileUpload.addEventListener('dragleave', handleDragLeave);
        fileUpload.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            fileUpload.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            fileUpload.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            fileUpload.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                // Additional check for drag and drop
                const audioExtensions = ['.mp3', '.flac', '.m4a', '.aac', '.ogg', '.wav', '.wma'];
                const fileName = file.name.toLowerCase();
                const isAudioFile = audioExtensions.some(ext => fileName.endsWith(ext));
                
                if (!isAudioFile) {
                    showStatus('Please drop an audio file. Supported formats: MP3, FLAC, M4A, AAC, OGG, WAV, WMA', 'error');
                    return;
                }
                handleFile(file);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        function handleFile(file) {
            // Check file extension for audio files
            const audioExtensions = ['.mp3', '.flac', '.m4a', '.aac', '.ogg', '.wav', '.wma'];
            const fileName = file.name.toLowerCase();
            const isAudioFile = audioExtensions.some(ext => fileName.endsWith(ext));
            
            if (!isAudioFile) {
                showStatus('Please select an audio file. Supported formats: MP3, FLAC, M4A, AAC, OGG, WAV, WMA', 'error');
                return;
            }

            currentFile = file;
            showFileInfo(file);
            loadMetadataFromFile(file);
            editorSection.style.display = 'block';
            showStatus('File loaded successfully! You can now edit the metadata.', 'success');
        }

        function showFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileSize = (file.size / (1024 * 1024)).toFixed(2);
            
            fileInfo.innerHTML = `
                <h3>üìÅ File Information</h3>
                <p><strong>Name:</strong> ${file.name}</p>
                <p><strong>Size:</strong> ${fileSize} MB</p>
                <p><strong>Type:</strong> ${file.type}</p>
                <p><strong>Last Modified:</strong> ${new Date(file.lastModified).toLocaleString()}</p>
            `;
        }

        async function loadMetadataFromFile(file) {
            try {
                showStatus('Reading metadata from file...', 'warning');
                
                // Use jsmediatags to parse metadata
                window.jsmediatags.read(file, {
                    onSuccess: function(tag) {
                        const tags = tag.tags;
                        
                        // Auto-fill form fields with existing metadata
                        document.getElementById('title').value = tags.title || '';
                        document.getElementById('artist').value = tags.artist || '';
                        document.getElementById('album').value = tags.album || '';
                        document.getElementById('albumArtist').value = tags.albumartist || tags.TPE2 || '';
                        document.getElementById('year').value = tags.year || '';
                        document.getElementById('track').value = tags.track || '';
                        document.getElementById('genre').value = tags.genre || '';
                        document.getElementById('composer').value = tags.composer || tags.TCOM || '';
                        document.getElementById('comment').value = tags.comment ? 
                            (tags.comment.text || tags.comment) : '';
                        
                        // Handle album artwork
                        if (tags.picture) {
                            const picture = tags.picture;
                            const arrayBuffer = new Uint8Array(picture.data);
                            const blob = new Blob([arrayBuffer], { type: picture.format });
                            displayArtworkFromBlob(blob, `artwork.${picture.format.split('/')[1] || 'jpg'}`);
                            showStatus('Metadata and artwork loaded successfully!', 'success');
                        } else {
                            // Clear artwork if no picture found
                            document.getElementById('artworkPreview').innerHTML = '';
                            showStatus('Metadata loaded successfully! No artwork found.', 'success');
                        }
                        
                        // Store original metadata for comparison
                        originalMetadata = {
                            title: tags.title || '',
                            artist: tags.artist || '',
                            album: tags.album || '',
                            albumArtist: tags.albumartist || tags.TPE2 || '',
                            year: tags.year || '',
                            track: tags.track || '',
                            genre: tags.genre || '',
                            composer: tags.composer || tags.TCOM || '',
                            comment: tags.comment || '',
                            hasArtwork: !!tags.picture
                        };
                    },
                    onError: function(error) {
                        console.error('Metadata parsing error:', error);
                        showStatus('Could not read metadata from file. You can still add new metadata manually.', 'warning');
                        
                        // Fallback: try to extract info from filename
                        const filename = file.name.replace(/\.[^/.]+$/, "");
                        const parts = filename.split(' - ');
                        
                        if (parts.length >= 2) {
                            document.getElementById('artist').value = parts[0].trim() || '';
                            document.getElementById('title').value = parts[1].trim() || '';
                        }
                        
                        // Clear other fields
                        clearMetadataFields();
                    }
                });
                
            } catch (error) {
                console.error('Metadata parsing error:', error);
                showStatus('Could not read metadata from file. You can still add new metadata manually.', 'warning');
                
                // Fallback: try to extract info from filename
                const filename = file.name.replace(/\.[^/.]+$/, "");
                const parts = filename.split(' - ');
                
                if (parts.length >= 2) {
                    document.getElementById('artist').value = parts[0].trim() || '';
                    document.getElementById('title').value = parts[1].trim() || '';
                }
                
                // Clear other fields
                clearMetadataFields();
            }
        }

        function clearMetadataFields() {
            const fields = ['album', 'albumArtist', 'year', 'track', 'genre', 'composer', 'comment'];
            fields.forEach(field => {
                document.getElementById(field).value = '';
            });
            
            // Clear artwork
            const artworkPreview = document.getElementById('artworkPreview');
            artworkPreview.innerHTML = '';
        }

        // Artwork handling
        const artworkUpload = document.getElementById('artworkUpload');
        const artworkInput = document.getElementById('artworkInput');

        artworkUpload.addEventListener('click', () => artworkInput.click());
        artworkInput.addEventListener('change', handleArtworkSelect);

        function handleArtworkSelect(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                if (file.type.startsWith('image/')) {
                    displayArtworkFromFile(file);
                    showStatus('Artwork uploaded successfully!', 'success');
                } else {
                    showStatus('Please select an image file for artwork.', 'error');
                }
            }
        }

        function displayArtworkFromFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const artworkPreview = document.getElementById('artworkPreview');
                artworkPreview.innerHTML = `
                    <img src="${e.target.result}" alt="Album Artwork">
                    <div class="artwork-info">
                        <p><strong>Filename:</strong> ${file.name}</p>
                        <p><strong>Size:</strong> ${(file.size / 1024).toFixed(1)} KB</p>
                        <p><strong>Dimensions:</strong> Loading...</p>
                        <button class="btn" onclick="removeArtwork()" style="background: #f44336; color: white; margin-top: 10px;">Remove</button>
                    </div>
                `;

                // Get image dimensions
                const img = new Image();
                img.onload = function() {
                    const dimensionElement = artworkPreview.querySelector('p:last-of-type');
                    if (dimensionElement) {
                        dimensionElement.textContent = `Dimensions: ${this.width} √ó ${this.height}px`;
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function displayArtworkFromBlob(blob, filename) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const artworkPreview = document.getElementById('artworkPreview');
                artworkPreview.innerHTML = `
                    <img src="${e.target.result}" alt="Album Artwork">
                    <div class="artwork-info">
                        <p><strong>Filename:</strong> ${filename}</p>
                        <p><strong>Size:</strong> ${(blob.size / 1024).toFixed(1)} KB</p>
                        <p><strong>Dimensions:</strong> Loading...</p>
                        <button class="btn" onclick="removeArtwork()" style="background: #f44336; color: white; margin-top: 10px;">Remove</button>
                    </div>
                `;

                // Get image dimensions
                const img = new Image();
                img.onload = function() {
                    const dimensionElement = artworkPreview.querySelector('p:last-of-type');
                    if (dimensionElement) {
                        dimensionElement.textContent = `Dimensions: ${this.width} √ó ${this.height}px`;
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(blob);
        }

        function removeArtwork() {
            document.getElementById('artworkPreview').innerHTML = '';
            document.getElementById('artworkInput').value = '';
            showStatus('Artwork removed.', 'warning');
        }

        // Button handlers
        document.getElementById('loadMetadata').addEventListener('click', () => {
            if (currentFile) {
                loadMetadataFromFile(currentFile);
            }
        });

        document.getElementById('saveMetadata').addEventListener('click', saveMetadata);
        document.getElementById('clearAll').addEventListener('click', clearAll);

        function saveMetadata() {
            if (!currentFile) {
                showStatus('No file loaded to save metadata to.', 'error');
                return;
            }

            // Collect all metadata
            const metadata = {
                title: document.getElementById('title').value,
                artist: document.getElementById('artist').value,
                album: document.getElementById('album').value,
                albumArtist: document.getElementById('albumArtist').value,
                year: document.getElementById('year').value,
                track: document.getElementById('track').value,
                genre: document.getElementById('genre').value,
                composer: document.getElementById('composer').value,
                comment: document.getElementById('comment').value,
                hasArtwork: document.getElementById('artworkPreview').innerHTML !== ''
            };

            // In a real implementation, this would write the metadata to the file
            // For demonstration, we'll show the collected metadata
            showStatus('Metadata saved successfully! (In a real implementation, this would write to the file)', 'success');
            
            console.log('Metadata to save:', metadata);
            
            // Create a download link with the metadata as JSON for demonstration
            const metadataBlob = new Blob([JSON.stringify(metadata, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(metadataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentFile.name}.metadata.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all metadata fields?')) {
                const fields = ['title', 'artist', 'album', 'albumArtist', 'year', 'track', 'genre', 'composer', 'comment'];
                fields.forEach(field => {
                    document.getElementById(field).value = '';
                });
                removeArtwork();
                showStatus('All fields cleared.', 'warning');
            }
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.className = `status-message status-${type}`;
            statusElement.textContent = message;
            statusElement.style.display = 'block';

            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        // Auto-save functionality
        const metadataFields = ['title', 'artist', 'album', 'albumArtist', 'year', 'track', 'genre', 'composer', 'comment'];
        metadataFields.forEach(field => {
            document.getElementById(field).addEventListener('input', () => {
                // Auto-save could be implemented here
                // For now, just indicate unsaved changes
                if (currentFile) {
                    showStatus('Changes detected. Don\'t forget to save!', 'warning');
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveMetadata();
                        break;
                    case 'o':
                        e.preventDefault();
                        fileInput.click();
                        break;
                }
            }
        });
    </script>
</body>
</html>
